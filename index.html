<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–∫–∞–Ω–µ—Ä 412</title>

<script src="quagga.min.js"></script>

<style>
    body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f8f9fa;
    }

    #scanner {
        width: 100%;
        height: 55vh;
        background: black;
        position: relative;
    }

    .controls {
        display: flex;
        gap: 8px;
        padding: 10px;
    }

    .controls button {
        flex: 1;
        height: 46px;
        font-size: 16px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
    }

    .controls button:active {
        transform: scale(0.98);
    }

    #list {
        padding: 10px;
    }

    .item {
        padding: 6px 0;
        border-bottom: 1px solid #ddd;
        font-size: 15px;
    }
</style>
</head>

<body>

<div id="scanner"></div>

<div class="controls">
    <button id="torchBtn">üî¶ –õ—ñ—Ö—Ç–∞—Ä–∏–∫</button>
    <button id="restartBtn">üì∑ –ö–∞–º–µ—Ä–∞</button>
    <button id="backBtn">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div class="controls">
    <button id="clearBtn">üóë –û—á–∏—Å—Ç–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
</div>

<div id="list"></div>

<script>
let isTorchOn = false;
let codes = [];

function startScanner() {
    Quagga.stop();

    Quagga.init({
        inputStream: {
            type: "LiveStream",
            target: document.querySelector("#scanner"),
            constraints: {
                facingMode: "environment"
            }
        },
        decoder: {
            readers: ["ean_reader", "ean_8_reader", "code_128_reader"]
        }
    }, err => {
        if (err) {
            console.error(err);
            return;
        }
        Quagga.start();
    });
}

startScanner();

/* ====== –°–ö–ê–ù ====== */
Quagga.onDetected(result => {
    const code = result.codeResult.code;
    if (!codes.includes(code)) {
        codes.push(code);
        renderList();
        navigator.vibrate?.(100);
    }
});

/* ====== –õ–Ü–•–¢–ê–†–ò–ö ====== */
document.getElementById("torchBtn").onclick = async function () {
    const track = Quagga.CameraAccess.getActiveTrack();
    if (!track) return;

    try {
        isTorchOn = !isTorchOn;

        await track.applyConstraints({
            advanced: [{ torch: isTorchOn }]
        });

        this.innerText = isTorchOn ? "üî¶ –í–∏–º–∫–Ω—É—Ç–∏" : "üî¶ –õ—ñ—Ö—Ç–∞—Ä–∏–∫";
    } catch (e) {
        console.warn("Torch error:", e);
    }
};

/* ====== –ü–ï–†–ï–ó–ê–ü–£–°–ö –ö–ê–ú–ï–†–ò ====== */
document.getElementById("restartBtn").onclick = () => {
    startScanner();
};

/* ====== –ù–ê–ó–ê–î ====== */
document.getElementById("backBtn").onclick = () => {
    history.back();
};

/* ====== –û–ß–ò–°–¢–ò–¢–ò –°–ü–ò–°–û–ö (–ë–ï–ó –ó–£–ü–ò–ù–ö–ò –ö–ê–ú–ï–†–ò) ====== */
document.getElementById("clearBtn").onclick = () => {
    codes = [];
    renderList();

    // üî• –ü–†–ò–ú–£–°–û–í–ò–ô RESTART –ö–ê–ú–ï–†–ò
    setTimeout(() => {
        startScanner();
    }, 100);
};

/* ====== –†–ï–ù–î–ï–† ====== */
function renderList() {
    const list = document.getElementById("list");
    list.innerHTML = "";
    codes.forEach(c => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = c;
        list.appendChild(div);
    });
}
</script>

</body>
</html>
